<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body oncontextmenu="return false;">
  <form id="MainForm">
    <input id="email" type="email" placeholder="Email" required />

    <input id="password" type="password" placeholder="Password" required />

    <select name="initial" id="initial" required>
      <option disabled selected value> -- select Initial -- </option>
      <option value="Mr.">Mr.</option>
      <option value="Mrs.">Mrs.</option>
    </select>

    <input id="fname" type="text" placeholder="First Name" required />

    <input id="mname" type="text" placeholder="Middle Name" required />

    <input id="lname" type="text" placeholder="Last Name" required />

    <input id="contact" type="number" placeholder="Phone number" required />

    <input id="birth" type="date" placeholder="Birthdate" required />

    <select name="Bloodgroup" id="blood" required>
      <option disabled selected value> -- select blood group -- </option>
      <option value="A+">A+</option>
      <option value="A-">A-</option>
      <option value="B+">B+</option>
      <option value="B-">B-</option>
      <option value="O+">O+</option>
      <option value="O-">O-</option>
      <option value="AB+">AB+</option>
      <option value="AB-">AB-</option>
    </select>

    <select name="school" id="school" required>
      <option value="SOCSET" selected="selected">SOCSET</option>
    </select>

    <select name="department" id="dept" required>
      <option disabled selected value> -- select department -- </option>
      <option value="B-tech">B.tech</option>
      <option value="M-tech">M.tech</option>
      <option value="Diploma">Diploma</option>
    </select>

    <select name="branch" id="branch" required>
      <option disabled selected value> -- select Branch -- </option>
      <option value="CSE">CSE</option>
      <option value="IT">IT</option>
    </select>

    <select name="Semester" id="sem" required>
      <option disabled selected value> -- select semester -- </option>
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
      <option value="7">7</option>
      <option value="8">8</option>
    </select>



    <input type="submit" value="Register" class="btn solid" />
  </form>


  <script type="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDENcX5YsvKeXRCLnPSkFsBg2aLfxlnDHQ",
      authDomain: "duraadharshah-ca0ca.firebaseapp.com",
      databaseURL: "https://duraadharshah-ca0ca-default-rtdb.firebaseio.com",
      projectId: "duraadharshah-ca0ca",
      storageBucket: "duraadharshah-ca0ca.appspot.com",
      messagingSenderId: "625665554854",
      appId: "1:625665554854:web:7dc2e4b4c0469413603767",
      measurementId: "G-W9RFMNZKC9"
    };


    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const auth = getAuth(app);

    let email = document.getElementById('email');
    let password = document.getElementById('password');
    let initial = document.getElementById('initial');
    let fname = document.getElementById('fname');
    let mname = document.getElementById('mname');
    let lname = document.getElementById('lname');
    let contact = document.getElementById('contact');
    let birth = document.getElementById('birth');
    let blood = document.getElementById('blood');
    let school = document.getElementById('school');
    let dept = document.getElementById('dept');
    let branch = document.getElementById('branch');
    let sem = document.getElementById('sem');
    let MainForm = document.getElementById('MainForm');

    let RegisterUser = evt => {
      evt.preventDefault();

      // Regular expression to match "duraadharshah.com" domain
      const validDomainRegex = /@duraadharshah\.com$/i; // Case-insensitive

      if (validDomainRegex.test(email.value)) {
        // Invalid domain, show an error message
        alert('Error: duraadharshah.com is not a valid domain trying entering with valid domain');
        return; // Prevent form submission
      }

      // If the domain is not "duraadharshah.com", proceed with user registration
      createUserWithEmailAndPassword(auth, email.value, password.value)
        .then((credentials) => {
          set(ref(db, 'UserAuthList/' + credentials.user.uid), {
            initial: initial.value,
            firstname: fname.value,
            middlename: mname.value,
            lastname: lname.value,
            contact: contact.value,
            birthdate: birth.value,
            bloodgroup: blood.value,
            school: school.value,
            department: dept.value,
            branch: branch.value,
            semester: sem.value,
          });

          email.value = '';
          password.value = '';
          initial.value = '';
          fname.value = '';
          mname.value = '';
          lname.value = '';
          contact.value = '';
          birth.value = '';
          blood.value = '';
          school.value = '';
          dept.value = '';
          branch.value = '';
          sem.value = '';

          alert('Registration successful! You can now log in.');
        })
        .catch((error) => {
          alert(error.message);
          console.log(error.code);
          console.log(error.message);
        });
    };

    MainForm.addEventListener('submit', RegisterUser);

  </script>
</body>

</html>